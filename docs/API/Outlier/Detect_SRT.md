# og.detect.Detect_SRT

!!! abstract "Class"
    <div id = 'SRT'><b>og.detect.Detect_SRT(<i>n_epochs=2, learning_rate=7e-6, sample_rate=1, mem_dim=1024, update_size=64, shrink_thres=0.5, temperature=3, n_critic=1, pretrain=True, GPU=True, verbose=True, log_interval=100, random_state=100, weight=None, batch_size=64, patch_size=48, MultiResSkips=True</i>)</b></div>

Detect outlier spots with gene expression, position and image as SRT mode of ODBC-GAN.

[og.detect.Detect_SRT](#SRT) has two important functions [fit](#fit) and [predict](#predict). This class has been integrated in [og.outlier_detect](./outlier_detect.md) as SRT mode.

**Parameters**:

- **n_epochs**: `int` (default: `2`)

    Number of train epochs.

- **learning_rate**: `float` (default: `7e-6`)

    Learning rate for Adam optim.

- **sample_rate**: `float` (default: `1`)

    Proportion of the actual train data to the input train data. Consider taking a smaller `sample_rare` when input train data is large-scale.

- **mem_dim**: `float` (default: `1024`)

    Number of embeddings stored in the memory bank. Larger `mem_dim` doesn't always mean better results, which means ODBC-GAN is insensitive to the size of memory bank.

- **update_size**: `int` (default: `64`)

    Number of embeddings updated in every epoch.

- **shrink_thres**: `float` (default: `0.5`)

    Shrinkage threshold for attention score in the memory unit.

- **temperature**: `float` (default: `3`)

    Temperature hyperparameter for attention score in the memory unit.

- **n_critic**: `int` (default: `1`)

    Number of times the discriminator is updated in a epoch. Moreover, generator is only updated once in a epoch.

- **pretrain**: `bool` (default: `True`)

    If `True`, load pretrained weight for ODBC-GAN.

- **GPU**: `bool` (default: `True`)

    If `True`, run ODBC-GAN on GPU.

- **verbose**: `bool` (default: `True`)

    If `True`, print detailed information of every epoch.

- **log_interval**: `int` (default: `100`)

    Interval of epochs between two adjacent printed information.

- **random_state**: `Optional[int]` (default: `100`)

    Random state to control all kinds of random seeds.

- **weight**: `Optional[Dict]` (default: `None`)

    Weight for every part of loss. If `None`, `weight` should be set as `{'w_rec': 50, 'w_adv': 1, 'w_enc': 1, 'w_gp': 10}`

- **batch_size**: `int` (default: `64`)

    Batch size of train data.

- **patch_size**: `int` (default: `48`)

    Side length of every patch.

- **MultiResSkips**: `bool` (default: `True`)

    If `True`, use Multi-Residual-Block Skips in image generator.

!!! info "Function of [og.detect.Detect_SRT](#SRT)"
    <div id = 'fit'><b>fit(<i>train, image</i>)</b></div>

Learn information of normal spots on train data by mini-batch.

Full graph of train data is generated by [og._dataset.Build_graph](../Dataset/Build_graph.md).

Every batch is a subgraph on the full graph, provided by [dgl.dataloading.DataLoader](https://docs.dgl.ai/en/latest/generated/dgl.dataloading.DataLoader.html).

**Parameters**:

- **train**: `anndata.AnnData`

    Train data of shape `n_obs` × `n_vars`. Rows correspond to cells and columns to genes.

- **image**: `numpy.ndarray`

    H&E image of train data.

!!! info "Function of [og.detect.Detect_SRT](#SRT)"
    <div id = 'predict'><b>predict(<i>test</i>, image)</b></div>

Detect outlier spots on test data by mini-batch.

Full graph of test data is generated by [og._dataset.Build_graph](../Dataset/Build_graph.md).

Every batch is a subgraph on the full graph, provided by [dgl.dataloading.DataLoader](https://docs.dgl.ai/en/latest/generated/dgl.dataloading.DataLoader.html).

**Parameters**:

- **test**: `anndata.AnnData`

    Test data of shape `n_obs` × `n_vars`. Rows correspond to cells and columns to genes.

- **image**: `numpy.ndarray`

    H&E image of test data.

**Returns**:

- **result**: `pandas.DataFrame`

    Results of outlier detection. `result['cell_idx']` contains `test.obs_names`, and `result['score']` contains the anomaly scores of every observation.

!!! warning
    - [fit](#fit) must be run before [predict](#predict).
    - `train` and `test` should have the same genes.
    - `train_image` and `test_image` are required. And the position of every spot on image should contain in `train.obsm['spatial']` and `test.obsm['spatial']`.
    - Default configuration is based on `pretrain=True`, which means fine-tuning ODBC-GAN. If `pretrain=False`, a set of new parameters is necessary.